name: Deploy Dashboard to GitHub Pages

# NOTE:
# - This workflow is currently configured to run ONLY when manually triggered.
# - This avoids failing builds while GitHub Pages is not yet fully enabled for the repository.
# - Once you have enabled Pages (Settings â†’ Pages â†’ Source: GitHub Actions),
#   you can re-enable automatic triggers (push/schedule) as needed.

on:
  workflow_dispatch:
    inputs:
      reason:
        description: 'Reason for manual deployment'
        required: false
        default: 'Manual trigger'
  # To enable automatic deployments after Pages is configured, uncomment:
  # push:
  #   branches:
  #     - main
  # schedule:
  #   # Run every hour to keep data fresh
  #   - cron: '0 * * * *'

jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pages: write
      id-token: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install streamlit plotly pandas numpy requests feedparser textblob
      
      - name: Generate static dashboard HTML
        env:
          GOLDAPI_API_KEY: ${{ secrets.GOLDAPI_API_KEY }}
        run: |
          # Streamlit doesn't directly support static export, so we'll use streamlit-browser
          # Alternative: Convert dashboard to a static HTML page
          python -c "
          import streamlit.web.cli as stcli
          import sys
          sys.argv = ['streamlit', 'run', 'live_dashboard.py', '--server.headless', 'true', '--server.port', '8501']
          "
      
      - name: Build static site
        run: |
          # Use the existing docs/index.html that redirects to Streamlit Cloud
          mkdir -p docs
          if [ ! -f docs/index.html ]; then
            echo "Creating redirect page..."
            cat > docs/index.html << 'EOF'
          <!DOCTYPE html>
          <html>
          <head>
              <title>Gold Price Prediction Dashboard</title>
              <meta http-equiv="refresh" content="3;url=https://share.streamlit.io">
              <meta name="viewport" content="width=device-width, initial-scale=1">
          </head>
          <body style="font-family: Arial; background: #1E1E1E; color: white; text-align: center; padding: 2rem;">
              <h1>ðŸ’° Gold Price Prediction Dashboard</h1>
              <p>Redirecting to Streamlit Cloud...</p>
              <p><a href="https://share.streamlit.io" style="color: #FFD700;">Click here if not redirected</a></p>
          </body>
          </html>
          EOF
          fi
      
      - name: Setup Pages
        uses: actions/configure-pages@v4
        with:
          # Explicitly allow this workflow to configure Pages when enabled
          enablement: true
      
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: './docs'
      
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4

